# Linux ARM Driver Framework

ARM64é©±åŠ¨å¼€å‘æ¡†æ¶ - å®Œå…¨ç‹¬ç«‹ï¼Œä¸€é”®ç¼–è¯‘

## âœ“ é¡¹ç›®ç‰¹ç‚¹

- **å®Œå…¨ç‹¬ç«‹**: æ‰€æœ‰ä¾èµ–éƒ½åœ¨é¡¹ç›®å†…ï¼Œä¸ä¾èµ–å¤–éƒ¨ç›®å½•
- **æ¶æ„**: ARM64 (aarch64)
- **å·¥å…·é“¾**: GNU 12.2.1ï¼ˆæœ¬åœ°ï¼‰
- **å†…æ ¸**: æœ¬åœ°å†…æ ¸å¤´æ–‡ä»¶
- **çŠ¶æ€**: âœ“ å¯éšæ„ç§»åŠ¨å’Œåˆ†äº«

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¼–è¯‘é©±åŠ¨

```bash
./build.sh
```

å°±è¿™ä¹ˆç®€å•ï¼

### 2ï¸âƒ£ è·å–ç”Ÿæˆçš„æ–‡ä»¶

ç¼–è¯‘å®Œæˆåï¼Œæ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨ `output/` ç›®å½•ï¼š

```bash
ls output/
# simple_driver.ko  - ARM64é©±åŠ¨æ¨¡å—
# test_app          - ARM64æµ‹è¯•ç¨‹åº
```

### 3ï¸âƒ£ éƒ¨ç½²åˆ°ARMè®¾å¤‡

```bash
# ä¼ è¾“é©±åŠ¨
scp output/*.ko user@device:/tmp/

# åœ¨è®¾å¤‡ä¸ŠåŠ è½½
sudo insmod simple_driver.ko

# æŸ¥çœ‹æ—¥å¿—
dmesg | tail

# å¸è½½é©±åŠ¨
sudo rmmod simple_driver
```

## ğŸ“ ç›®å½•ç»“æ„

```
linux_arm_driver/
â”œâ”€â”€ build.sh                  # ä¸€é”®ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ src/                      # é©±åŠ¨æºç 
â”œâ”€â”€ examples/                 # æµ‹è¯•ç¨‹åº
â”œâ”€â”€ include/                  # å¤´æ–‡ä»¶
â”œâ”€â”€ output/                   # ğŸ¯ ç”Ÿæˆçš„æ–‡ä»¶ (*.ko, æµ‹è¯•ç¨‹åº)
â”œâ”€â”€ dependencies/             # æœ¬åœ°ä¾èµ–ï¼ˆå·¥å…·é“¾å’Œå†…æ ¸ï¼‰
â”‚   â”œâ”€â”€ toolchain/           # ARM64äº¤å‰ç¼–è¯‘å·¥å…·é“¾
â”‚   â””â”€â”€ kernel/              # å†…æ ¸å¤´æ–‡ä»¶
â””â”€â”€ build/                    # ç¼–è¯‘ä¸­é—´æ–‡ä»¶ (å¯å¿½ç•¥)
```

**ğŸ’¡ æç¤º**: åªéœ€å…³æ³¨ `output/` ç›®å½•ï¼Œæ‰€æœ‰éœ€è¦çš„æ–‡ä»¶éƒ½åœ¨è¿™é‡Œï¼

## æ·»åŠ æ–°é©±åŠ¨

1. åœ¨ `src/` åˆ›å»º `my_driver.c`
2. ç¼–è¾‘ `src/Makefile`ï¼Œæ·»åŠ : `obj-m += my_driver.o`
3. è¿è¡Œ `./build.sh`
4. åœ¨ `output/` æ‰¾åˆ° `my_driver.ko`

## ï¿½ ä¿®æ”¹é…ç½®

å¦‚éœ€ä¿®æ”¹æ¶æ„æˆ–å·¥å…·é“¾é…ç½®ï¼Œç¼–è¾‘ `build.sh` çš„é…ç½®åŒºåŸŸï¼ˆç¬¬11-17è¡Œï¼‰ï¼š

```bash
# ARMæ¶æ„é…ç½®
ARCH=arm64    # å¯æ”¹ä¸º arm, x86 ç­‰

# å·¥å…·é“¾å’Œå†…æ ¸è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
TOOLCHAIN_PATH="$PROJECT_ROOT/dependencies/toolchain/bin"
KERNEL_DIR="$PROJECT_ROOT/dependencies/kernel"
```

**é¡¹ç›®å·²ä¼˜åŒ–ä¸ºç‹¬ç«‹æ¨¡å¼ï¼Œå¯ä»¥éšæ„ç§»åŠ¨å’Œåˆ†äº«ï¼ğŸš€**## ç›®å½•ç»“æ„

- `src/` - é©±åŠ¨æºç 
- `include/` - å¤´æ–‡ä»¶  
- `examples/` - æµ‹è¯•ç¨‹åº
- `build.sh` - **ä¸€é”®ç¼–è¯‘è„šæœ¬ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰**
- `å¿«é€Ÿå¼€å§‹.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜

## ç¼–è¯‘æ–¹å¼

```bash
# æ–¹å¼1: è‡ªåŠ¨æŸ¥æ‰¾å†…æ ¸ï¼ˆæ¨èï¼Œå·²åœ¨build.shä¸­é…ç½®è·¯å¾„ï¼‰
./build.sh

# æ–¹å¼2: ä¸´æ—¶æŒ‡å®šå†…æ ¸è·¯å¾„
KERNEL_DIR=~/linux ./build.sh
```

## Load/Unload Modules

```bash
sudo insmod src/simple_driver.ko
sudo insmod src/char_driver.ko
sudo rmmod simple_driver
sudo rmmod char_driver
```

## Test

```bash
./examples/test_app
```
